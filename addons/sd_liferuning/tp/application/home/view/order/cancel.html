{extend name="public/base" /}

<!--尾部-->

<!--返回顶部-->
{block name="content"}
{__block__}
<input type="hidden" name="mun_url" id="mun_url" value="6,4,false,待发货"/>
<div class="c-r right">
    <div class="label1">
        <div class="title">
            已取消列表
        </div>




        <div class="label-3 label">
            <!--<div class="Statistics">
                <span class="right">共有数据：<b>11</b>条</span>-->
            <!--<span class="right">共收钱：<b>0.55</b>元</span>
            <div class="clear"></div>
        </div>-->

            <div class="query">
                <div class="left">
                    <label>显示
                        <select name="">
                            <option value="">10</option>
                            <option value="">25</option>
                            <option value="">50</option>
                            <option value="">100</option>
                        </select>条
                    </label>
                </div>
                <div class="right">
                    <label>从当前数据中检索:
                        <input type="text" name="" id="" value="" />
                    </label>
                </div>
                <div class="clear"></div>
            </div>
            <div class="Tab Tabs">
                <table border="0" cellspacing="0" cellpadding="0" style="width: 100%;">
                    <thead>
                    <tr>
                        <th style="width: 40px;"><input type="checkbox" name="" id="" value="" /></th>
                        <th style="width: 40px;">ID</th>
                        <th style="width: 200px;">订单号<span><i class="triangle-up"></i><i class="triangle-down"></i></span></th>
                        <th style="width: 160px;">姓名<span><i class="triangle-up"></i><i class="triangle-down"></i></span></th>

                        <th style="width: 120px;">手机号<span><i class="triangle-up"></i><i class="triangle-down"></i></span></th>

                        <th style="width: 80px;">支付金额<span><i class="triangle-up"></i><i class="triangle-down"></i></span></th>
                        <th style="width: 80px;">状态<span><i class="triangle-up"></i><i class="triangle-down"></i></span></th>
                        <th style="">付款时间<span><i class="triangle-up"></i><i class="triangle-down"></i></span></th>

                        <th style="width: 120px;">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {foreach name="data" item="vo"}
                    <tr>
                        <td style="width: 40px;"><input type="checkbox" name="" id="" value="" /></td>
                        <td style="width: 40px; " class="goodsid" id="goodsid">{$vo.id}</td>
                        <td style="width: 200px;">{$vo.order_no}</td>
                        <td style="width: 160px;">{$vo.nickname}</td>
                        <td style="width: 120px;">{$vo.phone}</td>

                        <td style="width: 80px;">{$vo.price}</td>
                        <td style="width: 80px;">{$vo.status}</td>
                        <td style="">{$vo.time}</td>

                        <td style="width: 120px;">
                            <button class="modifybtn ml open-win" data-type="show?id={$vo.id}">详情</button>
                            <!--<button class="modifybtn ml user-confirm-close-btn" onclick="getId('{$vo.order_no}')">取消订单</button>-->
                            <!--<button class="openbtn ml bottom shelves open-wins" onclick="val_id('{$vo.id}')">发货</button>-->
                        </td>
                    </tr>
                    {/foreach}
                    </tbody>
                </table>
            </div>
            <div style="text-align: center" class="pages">
                {$data->render()}
            </div>
        </div>
    </div>
</div>

<div id="wrap" class="wrap">
    <div class="wrap-body express">
        <div class="title">

        </div>
        <iframe src="show" style="height: 100%; width: 100%;"></iframe>
        <span class="close-wrap close-win">×</span>
        <div class="wrap-btn">
            <span class="close-btn close-win">取消</span>
            <span class="next-btn close-win">确认</span>
        </div>
    </div>
</div>


<div id="wrap" class="wraps">
    <div class="express wrap-body_two" style="width: 424px;height: auto">
        <div class="title">
            运费计算规则
        </div>
        <div class="wrap-con">
            <div id="forms" class="formse" style="min-height: 200px;width: 424px;">
                <form action="addexpress" method="get" id="form_tow">
                    <div><label class="ltxt">快递:</label>
                        <div class="bor bor2 bor13">
                            <span>请选择</span><i></i>
                            <ul style="display: none;">
                                {foreach name="express" item="vo"}
                                <li data-type = "{$vo.exid}">{$vo.name}</li>
                                {/foreach}
                            </ul>
                        </div>
                        <span></span>
                    </div>
                    <div><label class="ltxt">运单号:</label>
                        <input type="text" name="number" id="number" value="" style="width: 202px;"/>
                        <span></span>
                    </div>
                    <input type="hidden" name="mun" id="mun" value="" />
                    <input type="hidden" name="pid" id="pid" value="" />
            </div>
            <div class="clear"></div>
        </div>
        <span class="close-wrap close-win">×</span>
        <div class="clear">

        </div>
        <div class="wrap-btn" style="width: 388px;">
            <input type="reset" name="" id="" value="取消" class="btn close-btn close-win"/>
            <input type="submit" name="" id="submit" value="确认" class="btn next-btn"/>
        </div>
        </form>
    </div>
</div>

<style>
    .user-confirm-wrap{
        position: fixed;
        margin-top: 300px;
        width: 100%;
        display: none;
    }
    .user-confirm{
        width: 600px;
        height: 300px;
        background: #FFFFFF;
        margin: 0 auto;
        display: block;
        box-shadow: 0 0 3px #333;
        text-align: right;
    }
    .send-info{
        width: 85%;
        margin: 30px 5%;
        border: 1px solid #ddd;
        resize: none;
        padding: 2.5%;
        border-radius: 5px;
    }
    .user-confirm button{
        font-size: 12px;
        margin: 15px 5% 0 0;
        padding: 10px 30px;
        background: #eeeeee;
        border-radius: 3px;
    }
    .user-confirm button:hover{
        background: #dddddd;
    }
    .user-confirm .success{
        background: #0a6999;
        color: #FFFFFF;
    }

    .user-confirm .success:hover{
        background: #053f5e;
    }
</style>

<div class="user-confirm-wrap">
    <div class="user-confirm">
        <textarea name="sendInfo" class="send-info" id="send-info" cols="30" rows="10" placeholder="请输入内容"></textarea>
        <button class="success" onclick="del_order()">确认</button>
        <button class="user-confirm-close-btn">取消</button>
    </div>
</div>

<script>

    let userConfirmStatus = false;
    let tempId = null;

    $('.user-confirm-close-btn').click(function () {
        userConfirmStatus = !userConfirmStatus;
        if(userConfirmStatus){
            $('.user-confirm-wrap').fadeIn(100);
        }else{
            tempId = null;
            $('#send-info').val("")
            $('.user-confirm-wrap').fadeOut(100);
        }
    });

    function getId(id) {
        tempId = id;
    }

    $("#submit").click(function(){
        var bor = $("#form_tow .bor13 span").attr('data-type');
        $("#mun").val(bor)
        if ($("#mun").val() == '') {
            prompt('不可为空',0)
            return false;
        }
        if ($("#number").val() == ''){
            prompt('不可为空',0)
            return false;
        }
    })


    $(".open-win").click(function(){
        var dataurl = $(this).attr('data-type');
        $("iframe").attr('src',dataurl)
    })
    function shelves(j,v){
        //var pid = j.parent().parent().find('.goodsid').text()
        var data = {
            goodsid:1,
        };
        $.ajax({
            type:'post',
            url:"__publicPath__/home/order/show",			//请求地址加参数
            data: data,
            success: function(data){
                location.replace(document.referrer);
                //Parent.find('.green').addClass('red')
            },
            error:function(){
                alert('更新失败')
            }
        });
    }
    function del_order() {
        let _sendInfo = $('#send-info').val();
        let _id = tempId;
        $.ajax({
            url:"{:url('order/del_order')}",
            dataType:'json',
            type:'get',
            data:{
                sendinfo: _sendInfo,
                id:_id
            },
            success:function (data) {
                if(data.state==1){
                    alert('取消成功！')
                    window.location.reload();
                }
            },
            error:function (error) {

            }
        })
    }

</script>

{/block}

